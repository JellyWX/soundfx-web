{% extends "base.html" %}
{% block content %}

<title>SoundFX - Dashboard</title>

<div class="container-fluid" style="min-height: 100vh;">

    <div class="row">

        <div class="col-md-1 col-lg-3 d-none d-md-block">

        </div>

        <div class="col-sm-12 col-md-10 col-lg-6">

            <h1 class="display-3 text-dark text-center" style="margin-top: 6rem;">Dashboard</h1>
            <a style="font-size: 1.4rem;" href="{{ url_for('all_collections') }}"><i class="fas fa-archive"></i> View Sound Collections</a>

            {% if user != None %}
                {% if user.sounds.__len__() > 0 %}
                <h3 class="display-5 text-dark">Your sounds</h3>
                <hr>

                <div class="container">
                    <div class="row">
                        {% for sound in user.sounds %}
                            {% include '_sound_item.html' %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if user.favorites.__len__() > 0 %}
                <br>
                <h3 class="display-5 text-dark">Favorited sounds</h3>
                <hr>

                <div class="container">
                    <div class="row">
                        {% for sound in user.favorites %}
                            {% include '_sound_item.html' %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            {% endif %}

            <h3 class="display-5 text-dark" style="margin-top: 2rem;">Public sounds</h3>
            <hr>

            <form action="{{ url_for('dashboard') }}" method="get">
                <div class="input-group">
                    <input type="text" name="query" class="form-control rounded" placeholder="Search Sound Repository..."></input>
                    <input type="submit" class="btn btn-primary" style="margin-left: 0.6rem;" value="Search"></input>
                </div>
            </form>

            <div class="container">
                <div class="row">
                    {% for sound in public %}
                        {% include '_sound_item.html' %}
                    {% endfor %}
                </div>
            </div>

            <hr>
            <div class="d-flex flex-row justify-content-between">
                {% if p - 1 >= 0 and not random %}
                <a href="{{ url_for('dashboard', query=q, page=p-1) }}"><i class="fas fa-arrow-circle-left" style="font-size: 3.6rem;"></i></a>
                {% else %}
                <p style="color: gray;"><i class="fas fa-arrow-circle-left" style="font-size: 3.6rem;"></i></p>
                {% endif %}

                <a href="{{ url_for('dashboard', random=1) }}"><i class="fas fa-random" style="font-size: 3.6rem;"></i></a>

                {% if p + 1 <= max_pages and not random %}
                <a href="{{ url_for('dashboard', query=q, page=p+1) }}"><i class="fas fa-arrow-circle-right" style="font-size: 3.6rem;"></i></a>
                {% else %}
                <p style="color: gray;"><i class="fas fa-arrow-circle-right" style="font-size: 3.6rem;"></i></p>
                {% endif %}
            </div>

            <br>
            <br>
            <br>

            <script>

function play(id) {
    let audio_src = '{{ url_for('audio') }}' + '?id=' + id;

    let sound = new Howl({
        src: [audio_src],
        format: 'mp3'
    });

    sound.play();
}

function favorite(id) {
    let url = '{{ url_for('fav') }}' + '?id=' + id;

    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
            if (this.responseText === 'added') {
                document.getElementById("f" + id).innerHTML = '<i style="font-size: 1.8rem; padding: 0.2rem;" class="fas fa-star"></i>';
            }
            else {
                document.getElementById("f" + id).innerHTML = '<i style="font-size: 1.8rem; padding: 0.2rem;" class="far fa-star"></i>';
            }
        }
    };
    xhttp.open("POST", url, true);
    xhttp.send();

}

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});

            </script>
        </div>
    </div>
</div>

{% endblock %}
